services:
  faster-whisper:
    image: fedirz/faster-whisper-server:latest-cuda
    container_name: voice-whisper
    restart: unless-stopped
    ports:
      - "8100:8000"
    volumes:
      - /mnt/Pool/configs/voice-assistant/whisper:/root/.cache/huggingface
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-medium
      - WHISPER__DEVICE=cuda
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]

  piper:
    image: rhasspy/wyoming-piper:latest
    container_name: voice-piper
    restart: unless-stopped
    ports:
      - "10200:10200"
    volumes:
      - /mnt/Pool/configs/voice-assistant/piper:/data
    command: >
      --voice en_US-lessac-medium
      --data-dir /data
      --download-dir /data

  voice-api:
    image: ghcr.io/iikoshteruu/voice_assistant/voice-orchestrator:latest
    container_name: voice-api
    restart: unless-stopped
    ports:
      - "8150:8000"
    volumes:
      - /mnt/Pool/configs/voice-assistant/data:/data
    environment:
      - WHISPER_URL=http://faster-whisper:8000
      - OLLAMA_URL=http://192.168.76.242:30068
      - OLLAMA_MODEL=llama3.2:3b
      - OLLAMA_EMBED_MODEL=nomic-embed-text
      - PIPER_HOST=piper
      - PIPER_PORT=10200
      - QDRANT_URL=http://192.168.76.242:6333
      - QDRANT_COLLECTION=socrates
      # Weather location (default: Los Angeles)
      - WEATHER_LAT=34.0522
      - WEATHER_LON=-118.2437
      - WEATHER_TIMEZONE=America/Los_Angeles
      # Twilio SMS (optional - uncomment and fill in to enable)
      # - TWILIO_ACCOUNT_SID=your_account_sid
      # - TWILIO_AUTH_TOKEN=your_auth_token
      # - TWILIO_FROM_NUMBER=+1234567890
    depends_on:
      - faster-whisper
      - piper
